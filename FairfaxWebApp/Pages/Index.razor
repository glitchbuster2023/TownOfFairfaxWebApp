@page "/"
@using FairfaxWebApp.Data
@inject IBulletinService BulletinService

<PageTitle>Index</PageTitle>

<div class="container">

    <div id="bulletinPoster" style="width: 100%; display: flex; align-items: center; justify-content: center;">
        <AuthorizeView>

            <Authorized>
                
                <EditForm Model="BulletinModel" OnSubmit="HandlePost" Context="NewBulletin">
                    <InputSelect @bind-Value="BulletinModel.Department" style="width: 100%;">
                        <option value="General">General Info</option>
                        <option value="Warning">Warning</option>
                        <option value="Water">Water Info</option>
                    </InputSelect>
                    <InputText @bind-Value="BulletinModel.Title" style="width: 100%;" placeholder="Title"></InputText>
                    <InputTextArea @bind-Value="BulletinModel.Content" style="width: 100%; resize: none; min-height: 100px;" placeholder="Bulletin content here."></InputTextArea>
                    <button style="text-align: center;">Create Bulletin!</button>
                </EditForm>
            </Authorized>

        </AuthorizeView>
    </div>


    
    <div style="width: 100%; max-height: 300px; overflow-y: scroll;">
        @if (_bulletins != null)
        {
            foreach (Bulletin b in _bulletins.OrderByDescending(p => p.PostedAt))
            {

                @if(b.Department == "General")
                {
                    <div style="width: 100%; float: left; margin-bottom: 30px; background-color:floralwhite; padding-left: 10px; padding-right: 10px; border-radius: 15px; padding-top: 5px; padding-bottom: 5px;">
                        <h2>@b.Title</h2>
                        <p style="font-style: italic;">@b.PostedAt</p>
                        <p style="word-break: break-all;">@b.Content</p>

                        <AuthorizeView>
                            <Authorized>
                                <button @onclick='()=>DeleteBulletin(b.Id)'>Delete Bulletin</button>
                            </Authorized>

                        </AuthorizeView>
                    </div>

                }
                @if(b.Department == "Warning")
                {
                    <div style="width: 100%; float: left; margin-bottom: 30px; background-color: indianred; padding-left: 10px; padding-right: 10px; border-radius: 15px; color: white; padding-top: 5px; padding-bottom: 5px;">
                        <h3>
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="yellow" class="w-6 h-6" style="max-width: 30px;">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z" />
                            </svg>
                            @b.Title
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="yellow" class="w-6 h-6" style="max-width: 30px;">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z" />
                            </svg>
                        </h3>
                        <p style="font-style: italic;">@b.PostedAt</p>
                        <p style="word-break: break-all;">@b.Content</p>

                        <AuthorizeView>
                            <Authorized>
                                <button @onclick='()=>DeleteBulletin(b.Id)'>Delete Bulletin</button>
                            </Authorized>

                        </AuthorizeView>
                    </div>
                }
                @if(b.Department == "Water")
                {
                    <div style="width: 100%; float: left; margin-bottom: 30px; background-color: cornflowerblue; padding-left: 10px; padding-right: 10px; border-radius: 15px; color: white; padding-top: 5px; padding-bottom: 5px;">
                        <h3>
                            @b.Title
                        </h3>
                        <p style="font-style: italic;">@b.PostedAt</p>
                        <p style="word-break: break-all;">@b.Content</p>

                        <AuthorizeView>
                            <Authorized>
                                <button @onclick='()=>DeleteBulletin(b.Id)'>Delete Bulletin</button>
                            </Authorized>

                        </AuthorizeView>
                    </div>
                }





        }
        }
    </div>

    <div class="row" style="margin-top: 20px; text-align: center;">
        <div class="col-sm">
            <img src=".\Images\library.jpg" class="card-img-top" alt="..." style="max-height: 240px; height: 220px;" />
            <div class="card-body">
                <h5 class="card-title">Fairfax Public Library</h5>
                <p class="card-text">Want to catch up on some reading or get some fresh reading material? Visit our public library today!</p>
                <div class="row justify-content-center">
                    <a href="/publiclibrary" class="btn btn-primary" style="max-width: 120px;">More Info</a>
                </div>
            </div>
        </div>

        <div class="col-sm">
            <img src=".\Images\lake.jpg" class="card-img-top" alt="..." style="max-height: 240px; height: 220px;" />
            <div class="card-body">
                <h5 class="card-title">Fairfax City Lake</h5>
                <p class="card-text">
                    Fairfax City Lake is located in Osage County, 4 miles northwest of Fairfax.
                    <br />
                    <br />
                </p>
                <div class="row justify-content-center">
                    <a href="/citylake" class="btn btn-primary" style="max-width: 120px;">More Info</a>
                </div>
            </div>
        </div>

        <div class="col-sm">
            <img src=".\Images\city_hall.jpg" class="card-img-top" alt="..." style="max-height: 220px; height: 220px;" />
            <div class="card-body">
                <h5 class="card-title">Fairfax City Hall</h5>
                <p class="card-text">
                    Fairfax City Hall. Find information about how to contact City Hall!
                    <br />
                    <br />
                    <br />
                </p>
                <div class="row justify-content-center">
                    <a href="/cityhall" class="btn btn-primary" style="max-width: 120px;">More Info</a>
                </div>
            </div>
        </div>

        <div class="col-sm">
            <img src=".\Images\animalcontrol.jpg" class="card-img-top" alt="..." style="max-height: 220px; height: 220px;" />
            <div class="card-body">
                <h5 class="card-title">Fairfax Animal Control</h5>
                <p class="card-text">
                    ~More Info Coming Soon~
                    <br />
                    <br />
                    <br />
                    <br />
                </p>
                <div class="row justify-content-center">
                    <a href="/animalcontrol" class="btn btn-primary" style="max-width: 120px;">More Info</a>
                </div>
            </div>
        </div>

    </div>
    
    <div class="row">

       
    </div>
   

</div>


@code {
    private Bulletin BulletinModel = new();

    private List<Bulletin> _bulletins { get; set; }

    protected override async Task OnInitializedAsync()
    {
        _bulletins = await BulletinService.GetAllBulletins();
        BulletinModel.Department = "- Select Bulletin Type -";
    }

    protected async Task FetchData()
    {
        _bulletins = new();
        _bulletins = await BulletinService.GetAllBulletins();
    }

    protected async Task DeleteBulletin(int id)
    {
        await BulletinService.RemoveBulletin(id);
        await FetchData();
    }

    protected async Task HandlePost()
    {
        BulletinModel.PostedAt = DateTime.Now;

        if (BulletinModel.Department == "- Select Bulletin Type -")
        {
            BulletinModel.Department = "General";
        }

        await BulletinService.CreateBulletin(BulletinModel);
        BulletinModel = new();
        await FetchData();
    }

}